# POV, Point Of Vehicle View

Update the `GZ_SIM_RESOURCE_PATH` to include these models:

```bash
export GZ_SIM_RESOURCE_PATH=$GZ_SIM_RESOURCE_PATH:\
$HOME/SITL_Models/Gazebo/models:\
$HOME/SITL_Models/Gazebo/worlds
```

## Ardupilot

```
git clone https://github.com/ArduPilot/ardupilot.git
cd ardupilot
git submodule update --init --recursive
```

```
docker build . -t ardupilot --build-arg USER_UID=$(id -u) --build-arg USER_GID=$(id -g)
```

```
docker run --rm -it -v "$(pwd):/ardupilot" -u "$(id -u):$(id -g)" ardupilot:latest bash
```

```
./waf configure --board=sitl
./waf build --target=bin/ardurover
```

#### Run Gazebo

```bash
gz sim -v4 -r r1_rover_runway.sdf
```

#### Run ArduPilot SITL from gazebo ardupilot document

The model may be run with the default `rover-skid` SITL parameters.
A set of custom parameters is provided with steering and speed PIDs
generated by the [`rover-quicktune.lua`](https://github.com/ArduPilot/ardupilot/blob/master/libraries/AP_Scripting/applets/rover-quicktune.lua) script.

```bash
sim_vehicle.py -v Rover -f rover-skid --model JSON --add-param-file=$HOME/SITL_Models/Gazebo/config/r1_rover.param --console --map
```

---

# run from host

## Sitl
Run sitl from outside the docker
(SITL fail to run from docker)
```bash
# run latest version
/home/user/git/ardupilot/build/sitl/bin/ardurover -S --model JSON --speedup 1 --slave 0 --defaults /home/user/workspaces/pov_ws/src/pov_bringup/config/rover.param,/home/user/workspaces/pov_ws/src/pov_bringup/config/rover-skid.param --sim-address=127.0.0.1 -I0
```

```bash
# version 4.5.7
/home/user/workspaces/pov_ws/src/pov_bringup/bin/ardurover.4.5.7 -S --model JSON --speedup 1 --slave 0 --defaults /home/user/workspaces/pov_ws/src/pov_bringup/config/rover.param,/home/user/workspaces/pov_ws/src/pov_bringup/config/rover-skid.param --sim-address=127.0.0.1 -I0
```

```bash
# run mavros as router 
ros2 run mavros mavros_node --ros-args -p fcu_url:=udp://0.0.0.0:14550@127.0.0.1:14550 -p gcs_url:=udp://@10.0.0.2:14551
```

---

## Resources
- [leo-simulator-ros2](https://github.com/LeoRover/leo_simulator-ros2/tree/ros2)
- [ardupilot sitl with gazebo](https://ardupilot.org/dev/docs/sitl-with-gazebo.html)


```
# Shell A:
. ~/bridge_ws/install/setup.bash

Now we start the ROS listener.

# Shell B:
. /opt/ros/rolling/setup.bash
ros2 topic echo /chatter

Now we start the Gazebo Transport talker.

# Shell C:
gz topic -t /chatter -m gz.msgs.StringMsg -p 'data:"Hello"'

```


## Resource
- [ros2-gazebo-aruco](https://github.com/SaxionMechatronics/ros2-gazebo-aruco/tree/main)